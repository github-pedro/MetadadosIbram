import requests
import json
import pandas as pd

dict_endpoint = {
"col_endpoint":"/wp-json/tainacan/v2/collections",
"meta_endpoint":"/wp-json/tainacan/v2/collection/{}/metadata/?perpage={}",
"tax_endpoint":"/wp-json/tainacan/v2/taxonomies",
"item_endpoint":"/wp-json/tainacan/v2/collection/{}/items/?perpage={}&paged={}"}


instalacoes= {    
    "Museu Victor Meirelles":["http://museuvictormeirelles.acervos.museus.gov.br","1"],
    "Museu Histórico Nacional":["http://mhn.acervos.museus.gov.br","2"],
    "Museu do Diamante":["http://museudodiamante.acervos.museus.gov.br","3"],
    "Museu do Ouro":["http://museudoouro.acervos.museus.gov.br","4"],
    "Museu Regional Casa dos Ottoni":["http://museuregionalcasadosottoni.acervos.museus.gov.br","5"],
    "Museu de Itaipu":["http://museudearqueologiadeitaipu.museus.gov.br","6"],
    "Museu das Bandeiras":["http://museusibramgoias.acervos.museus.gov.br/","7"],
    "Museu das Missões":["http://museudasmissoes.acervos.museus.gov.br/","8"]
}
def insert_values(meta_dict,meta, dict_key, json_key):
    if json_key in meta.keys():
        meta_dict[dict_key].append(meta[json_key])
    else:
        meta_dict[dict_key].append("")
        
metadados_dict = {"id_instalacao":[],"collection_id":[],"id_metadado":[],"name":[],"description":[],"metadata_type":[],"required":[],"collection_key":[],"multiple":[],"display":[],"semantic_uri":[]}
for k in instalacoes.keys():
        collections = requests.get(instalacoes[k][0]+dict_endpoint["col_endpoint"]).json()
       
        if len(collections)>1:
            for number in range(0,len(collections)):
                metadata = requests.get(instalacoes[k][0]+dict_endpoint["meta_endpoint"].format(collections[number]["id"],len(collections[number]["metadata_order"]))).json()
                for meta in metadata:
                    metadados_dict["id_instalacao"].append(instalacoes[k][1])
                    insert_values(metadados_dict,meta,"collection_id","collection_id")
                    insert_values(metadados_dict,meta,"id_metadado","id")
                    insert_values(metadados_dict,meta,"name","name")
                    insert_values(metadados_dict,meta,"description","description")
                    insert_values(metadados_dict,meta,"metadata_type","metadata_type")
                    insert_values(metadados_dict,meta,"required","required")
                    insert_values(metadados_dict,meta,"collection_key","collection_key")
                    insert_values(metadados_dict,meta,"multiple","multiple")
                    insert_values(metadados_dict,meta,"display","display")
                    insert_values(metadados_dict,meta,"semantic_uri","semantic_uri")
        else:
            metadata = requests.get(instalacoes[k][0]+dict_endpoint["meta_endpoint"].format(collections[0]["id"],len(collections[0]["metadata_order"]))).json()
            for meta in metadata:
                metadados_dict["id_instalacao"].append(instalacoes[k][1])
                insert_values(metadados_dict,meta,"collection_id","collection_id")
                insert_values(metadados_dict,meta,"id_metadado","id")
                insert_values(metadados_dict,meta,"name","name")
                insert_values(metadados_dict,meta,"description","description")
                insert_values(metadados_dict,meta,"metadata_type","metadata_type")
                insert_values(metadados_dict,meta,"required","required")
                insert_values(metadados_dict,meta,"collection_key","collection_key")
                insert_values(metadados_dict,meta,"multiple","multiple")
                insert_values(metadados_dict,meta,"display","display")
                insert_values(metadados_dict,meta,"semantic_uri","semantic_uri")
             
meta_df = pd.DataFrame.from_dict(metadados_dict)
print(meta_df)
meta_df.to_csv('metadadosIbram.csv')
